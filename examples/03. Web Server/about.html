<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css">
    <title>Xen WebServer | About</title>
</head>
<body>
    <h1>About</h1>
    <a href="/">Home</a>
    <p>This web server was built with the Xen programming language.</p>
    <p>This is the entire block of code powering this website:</p>
    <pre>
        <code style="font-size: 10pt !important;">
include io;
include net;
include os;

class WebServer {
    port = 3000;
    private _listener = null;

    init(port) {
        this.port = port;
    }

    private fn build_html_response(html_file) {
        const var html = os.readtxt(html_file);
        if (html != null) {
            var resp = "HTTP/1.1 200 OK\nContent-Type: text/html\n\n" + html;
            return resp;
        }
        return null;
    }

    private fn build_404_response() {
        return "HTTP/1.1 404 Not Found";
    }

    private fn handle_route(route, method, conn) {
        io.println("Client requested '", route, "'");
        if (route == "/") { 
            const var resp = this.build_html_response("./index.html");
            conn.send(resp);
        }
        else if (route == "/about") {
            const var resp = this.build_html_response("./about.html");
            conn.send(resp);
        }
        else {
            conn.send(this.build_404_response());
        }
    }

    fn listen() {
        this._listener = new net.TcpListener(this.port);
        this._listener.bind_and_listen();
        
        io.println("Started server at http://127.0.0.1:", this.port);

        while (true) {
            var conn = this._listener.accept();
            if (conn != null) {
                const var body = conn.read();
                var path_index = body.find("/");
                if (body.contains("HTTP")) {
                    var method = body.substr(0, path_index - 1);
                    var http_index = body.find("HTTP");
                    var route = body.substr(path_index, http_index - 5);

                    this.handle_route(route, method, conn);
                }
            }
            conn.close();
        }

        this._listener.close();
    }
};

const var server = new WebServer(8080);
server.listen();
        </code>
    </pre>
</body>
</html>
